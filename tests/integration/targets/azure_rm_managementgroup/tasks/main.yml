---
- name: Get list of all managementgroups
  register: az_all_managementgroups
  azure.azcollection.azure_rm_managementgroup_info:

- name: Get a managementgroup by id
  register: az_recursive_managementgroups
  azure.azcollection.azure_rm_managementgroup_info:
    id: "{{ az_all_managementgroups.management_groups[0].id }}"
    recurse: true
    flatten: true
    children: true

- name: Get a managementgroup by name
  azure.azcollection.azure_rm_managementgroup_info:
    name: "{{ az_all_managementgroups.management_groups[0].name }}"
    recurse: true
    flatten: true

- name: Test invalid name id combo
  register: invalid_name
  ignore_errors: true
  azure.azcollection.azure_rm_managementgroup_info:
    name: "{{ az_all_managementgroups.management_groups[0].name }}"
    id: "{{ az_all_managementgroups.management_groups[0].id }}"

- name: Validate expected states
  ansible.builtin.assert:
    that:
      - invalid_name['failed']

- name: Validate expected attributes
  ansible.builtin.assert:
    that: "{{ az_recursive_managementgroups.management_groups + az_recursive_managementgroups.subscriptions }}"
