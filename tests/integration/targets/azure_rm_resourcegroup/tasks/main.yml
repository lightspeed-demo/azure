---
- name: Get resource group datalake info
  register: rg
  azure.azcollection.azure_rm_resourcegroup_info:
    name: "{{ resource_group_datalake }}"
    list_resources: true

- name: Assert the resource group facts
  ansible.builtin.assert:
    that:
      - rg.resourcegroups | length == 1
      - rg.resourcegroups[0].resources | length >= 0

- name: Get resource group info
  register: rg
  azure.azcollection.azure_rm_resourcegroup_info:

- name: Assert all resource group facts
  ansible.builtin.assert:
    that:
      - rg.resourcegroups | length >= 1

- name: Get resource group info
  register: rg
  azure.azcollection.azure_rm_resourcegroup_info:
    name: "{{ resource_group }}"
    list_resources: true

- name: Assert the resource group facts
  ansible.builtin.assert:
    that:
      - rg.resourcegroups | length == 1
      - rg.resourcegroups[0].resources | length >= 0

- name: Create resource group (idempontent)
  register: output
  azure.azcollection.azure_rm_resourcegroup:
    name: "{{ resource_group }}"
    location: "{{ rg.resourcegroups[0].location }}"

- name: Assert idempotent
  ansible.builtin.assert:
    that:
      - not output.changed

- name: Delete resource group
  check_mode: true
  register: output
  azure.azcollection.azure_rm_resourcegroup:
    name: "{{ resource_group }}"
    state: absent

- name: Assert the resource group deleted
  ansible.builtin.assert:
    that:
      - output.changed
