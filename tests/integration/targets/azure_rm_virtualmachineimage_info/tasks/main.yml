---
- name: Set location
  ansible.builtin.set_fact:
    location: eastus

- name: Get facts for a specific image
  register: output
  azure.azcollection.azure_rm_virtualmachineimage_info:
    location: "{{ location }}"
    publisher: OpenLogic
    offer: CentOS
    sku: "7.5"
    version: 7.5.201808150

- name: Assert the image facts
  ansible.builtin.assert:
    that: output['vmimages'] | length == 1

- name: List available versions
  register: output
  azure.azcollection.azure_rm_virtualmachineimage_info:
    location: "{{ location }}"
    publisher: OpenLogic
    offer: CentOS
    sku: "7.5"

- name: Assert all image version facts
  ansible.builtin.assert:
    that: output['vmimages'] | length > 0

- name: List available offers
  register: output
  azure.azcollection.azure_rm_virtualmachineimage_info:
    location: "{{ location }}"
    publisher: OpenLogic

- name: Assert image facts
  ansible.builtin.assert:
    that: output['vmimages'] | length > 0

- name: List available publishers
  register: output
  azure.azcollection.azure_rm_virtualmachineimage_info:
    location: "{{ location }}"

- name: Assert image facts
  ansible.builtin.assert:
    that: output['vmimages'] | length > 0

- name: Get facts for a specific image's latest version
  register: output
  azure.azcollection.azure_rm_virtualmachineimage_info:
    location: "{{ location }}"
    publisher: OpenLogic
    offer: CentOS
    sku: "7.5"
    version: latest

- name: Assert image facts
  ansible.builtin.assert:
    that: output['vmimages'] | length == 1
